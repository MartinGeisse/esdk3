.option norvc

// helper for GP initialization, see below
.section .sdata
sdataSection:
.text
textSection:

////////////////////////////////////////////////////////////////////////////////////////////////////
// fixed locations
////////////////////////////////////////////////////////////////////////////////////////////////////

.set fastRamSize, 0x00004000 // 16kB
.set stackRegionEnd, fastRamSize

////////////////////////////////////////////////////////////////////////////////////////////////////
// entry points
////////////////////////////////////////////////////////////////////////////////////////////////////

.globl entryPoint
entryPoint:
    j start
    j interruptEntry

////////////////////////////////////////////////////////////////////////////////////////////////////
// function table for built-in functions
////////////////////////////////////////////////////////////////////////////////////////////////////

// the following are built-in library functions so they can be executed from small (fast) RAM
functionTable:
    .word udivrem
    .word udiv
    .word urem
    .word div
    .word termInitialize
    .word termPrintString
    .word termPrintChar
    .word termPrintInt
    .word termPrintUnsignedInt
    .word termPrintHexInt
    .word termPrintUnsignedHexInt
    .word termPrintln
    .word termPrintlnString
    .word termPrintlnChar
    .word termPrintlnInt
    .word termPrintlnUnsignedInt
    .word termPrintlnHexInt
    .word termPrintlnUnsignedHexInt
    .word profReset
    .word profLog
    .word profDisplay

////////////////////////////////////////////////////////////////////////////////////////////////////
// startup
////////////////////////////////////////////////////////////////////////////////////////////////////

start:

    // initialize the GP register
    .option push
    .option norelax
    la gp, __global_pointer$
    .option pop

    // initialize the SP register
    li sp, stackRegionEnd

    // invoke the main function, then lock up
    call main
hang:
    j hang

////////////////////////////////////////////////////////////////////////////////////////////////////
// interrupts
////////////////////////////////////////////////////////////////////////////////////////////////////

// interrupts not supported yet
interruptEntry:
    j interruptEntry
